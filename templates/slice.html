<html>
    <head>
        <title>Slice Kit</title>
        <link rel="stylesheet" href="/style.css">
        <!-- Include WaveSurfer.js from CDN -->
        <script src="https://unpkg.com/wavesurfer.js"></script>
    </head>
    <body>
        <h2>Choose a WAV file to slice into a Choke Kit</h2>
        {message_html}
        <form enctype="multipart/form-data" method="post">
            <input type="hidden" name="action" value="slice"/>
            <input type="hidden" name="mode" id="mode" value="download"/>
            <label for="file">Select WAV file:</label>
            <input id="file" name="file" type="file" accept=".wav" required/>
            <br/><br/>
            <label for="num_slices">Number of slices (1-16):</label>
            <input id="num_slices" name="num_slices" type="number" min="1" max="16" value="16" required/>
            <br/><br/>
            <button type="submit" onclick="document.getElementById('mode').value = 'download'">Download .ablpresetbundle</button>
            <button type="submit" onclick="document.getElementById('mode').value = 'auto_place'">Save Preset directly on Move</button>
        </form>
        
        <!-- Waveform container -->
        <div id="waveform" style="width: 100%; height: 128px;"></div>
        
        <script>
            // Initialize WaveSurfer
            const wavesurfer = WaveSurfer.create({
                container: '#waveform',
                waveColor: 'violet',
                progressColor: 'purple',
                height: 128,
                responsive: true,
            });

            // Load waveform when a file is selected
            document.getElementById('file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    wavesurfer.loadBlob(file);
                }
            });
        </script>
    </body>
</html>
