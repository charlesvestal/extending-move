<html>
    <head>
        <title>Move - Extended</title>
        <style>
            body {
                font-family: Arial, sans-serif;
            }
            .tab {
                overflow: hidden;
                border-bottom: 1px solid #ccc;
                background-color: #f1f1f1;
            }
            .tab button {
                background-color: inherit;
                border: none;
                outline: none;
                cursor: pointer;
                padding: 14px 16px;
                transition: 0.3s;
                font-size: 17px;
            }
            .tab button:hover {
                background-color: #ddd;
            }
            .tab button.active {
                background-color: #ccc;
            }
            .tabcontent {
                display: none;
                padding: 20px;
            }
        </style>
        <script>
            function openTab(evt, tabName) {
                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById(tabName).style.display = "block";
                evt.currentTarget.className += " active";

                // Dynamically load the content
                fetchContent(tabName).then(() => {
                    attachFormHandler(tabName);
                });
            }

            async function fetchContent(tabName) {
                try {
                    const response = await fetch(`/${tabName.toLowerCase()}`);
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.text();
                    document.getElementById(tabName).innerHTML = data;
                } catch (error) {
                    document.getElementById(tabName).innerHTML = `<p style="color: red;">Error loading content: ${error}</p>`;
                }
            }

            function attachFormHandler(tabName) {
                const form = document.querySelector(`#${tabName} form`);
                if (form) {
                    form.addEventListener('submit', async function(event) {
                        event.preventDefault(); // Prevent the default form submission

                        const formData = new FormData(form);
                        const url = `/${tabName.toLowerCase()}`;
                        const method = form.method.toUpperCase();

                        try {
                            const response = await fetch(url, {
                                method: method,
                                body: formData
                            });

                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }

                            const result = await response.text();
                            document.getElementById(tabName).innerHTML = result;

                            // Re-attach the form handler in case of multiple submissions
                            attachFormHandler(tabName);
                        } catch (error) {
                            document.getElementById(tabName).innerHTML = `<p style="color: red;">Error submitting form: ${error}</p>`;
                        }
                    });
                }
            }

            // Open the default tab when the page loads
            window.onload = function() {
                document.getElementById("defaultOpen").click();
            }
        </script>
    </head>
    <body>
        <h1>Move - Extended</h1>
        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'Slice')" id="defaultOpen">Slice Kit</button>
            <button class="tablinks" onclick="openTab(event, 'Refresh')">Refresh Library</button>
        </div>

        <div id="Slice" class="tabcontent">
            <!-- The Slice Kit form content will be loaded here dynamically -->
        </div>

        <div id="Refresh" class="tabcontent">
            <!-- The Refresh Library form content will be loaded here dynamically -->
        </div>
    </body>
</html>
